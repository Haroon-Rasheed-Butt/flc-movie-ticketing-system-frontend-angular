<section class="detail" *ngIf="movie">
  <div class="poster">
    <img [src]="movie.coverPhoto || 'https://source.unsplash.com/random/720x320?cinema'" [alt]="movie.name" />
  </div>
  <div class="info">
    <h1>{{ movie.name }}</h1>
    <p class="subtitle">{{ movie.typeName }} · {{ movie.genre || 'General' }}</p>
    <p>{{ movie.description }}</p>
    <div class="meta-row">
      <span>Directed by {{ movie.director || 'TBD' }}</span>
      <span>Actor: {{ movie.actor || 'TBD' }}</span>
    </div>
    <div class="meta-row">
      <span>Ticket: ₹{{ movie.ticketPrice.toFixed(2) }}</span>
      <span>Year: {{ movie.publicationYear || 'TBD' }}</span>
    </div>
    <div class="rating-summary">
      <strong>Average rating:</strong>
      <span>{{ averageRating.toFixed(1) }}/5 ({{ ratings.length }} reviews)</span>
    </div>
    <form class="cart-form" [formGroup]="cartForm" (ngSubmit)="addToCart()">
      <h3>Add to cart</h3>
      <div class="field-row">
        <mat-form-field appearance="fill">
          <mat-label>Account</mat-label>
          <mat-select formControlName="accountId">
            <mat-option *ngFor="let account of sampleAccounts" [value]="account.id">{{ account.label }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Quantity</mat-label>
          <input matInput type="number" formControlName="quantity" />
        </mat-form-field>
      </div>
      <button mat-raised-button color="primary" type="submit" [disabled]="cartForm.invalid">Add to cart</button>
    </form>
    <form class="rating-form" [formGroup]="ratingForm" (ngSubmit)="submitRating()">
      <h3>Add rating</h3>
      <div class="field-row">
        <mat-form-field appearance="fill">
          <mat-label>Account</mat-label>
          <mat-select formControlName="accountId">
            <mat-option *ngFor="let account of sampleAccounts" [value]="account.id">{{ account.label }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Stars</mat-label>
          <input matInput type="number" formControlName="rating" />
        </mat-form-field>
      </div>
      <mat-form-field appearance="fill">
        <mat-label>Comment</mat-label>
        <textarea matInput formControlName="comment"></textarea>
      </mat-form-field>
      <button mat-stroked-button color="accent" type="submit" [disabled]="ratingForm.invalid">Submit rating</button>
    </form>
  </div>
</section>

<section class="rating-section">
  <h2>Community ratings</h2>
  <app-rating-list [ratings]="ratings"></app-rating-list>
</section>
